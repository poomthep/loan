<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>อัตรามาตรฐานรายธนาคาร (MRR / MLR / MOR)</title>
  <link rel="stylesheet" href="/admin-ui.css?v=1"/>
</head>
<body>
  <header>
    <div class="header-wrap">
      <h1 class="brand">อัตรามาตรฐานรายธนาคาร</h1>
      <nav class="nav">
        <a href="/admin.html">โปรโมชัน</a>
        <a href="/admin_rates.html" class="active">อัตรามาตรฐาน</a>
      </nav>
      <div class="logout-slot">
        <button id="logout-btn" class="btn btn-primary btn-sm">ออกจากระบบ</button>
      </div>
    </div>
  </header>

  <main class="container">
    <section class="card" style="margin-bottom:12px">
      <h2 class="section-title">จัดการค่ามาตรฐาน</h2>
      <div class="form-grid" style="grid-template-columns:repeat(6,minmax(0,1fr))">
        <div class="field"><label>ธนาคาร</label><select class="input" id="rates-bank-select"></select></div>
        <div class="field"><label>ชนิด</label><select class="input" id="rates-type-select"><option value="MRR">MRR</option><option value="MLR">MLR</option><option value="MOR">MOR</option></select></div>
        <div class="field"><label>อัตรา (%)</label><input class="input" id="rates-value" type="text" inputmode="decimal" enterkeyhint="next" placeholder="8.100"></div>
        <div class="field"><label>วันที่มีผล</label><input class="input" id="rates-date" type="date" enterkeyhint="next"></div>
        <div class="field"><label>แหล่งข้อมูล (URL)</label><input class="input" id="rates-source" type="url" placeholder="https://..."></div>
        <div class="field" style="display:flex;align-items:end"><button id="rates-add-btn" class="btn btn-primary" title="เพิ่มรายการ">เพิ่มรายการ</button></div>
      </div>
      <div class="actions" style="margin-top:10px">
        <button id="apply-latest-one" class="btn btn-secondary">ใช้ค่าล่าสุด (ธนาคารนี้)</button>
        <button id="apply-latest-all" class="btn">ใช้ค่าล่าสุด (ทั้งหมด)</button>
      </div>
      <p class="muted" style="margin-top:8px">บันทึกประวัติลงตาราง <code>base_rates</code> และสามารถดึง “ค่าล่าสุด” ไปอัปเดต <code>banks.current_*</code> ได้</p>
    </section>

    <section class="card">
      <h2 class="section-title">ประวัติอัตรามาตรฐาน</h2>
      <table>
        <thead><tr><th style="min-width:120px">วันที่มีผล</th><th>ชนิด</th><th class="num">อัตรา (%)</th><th>ที่มา</th></tr></thead>
        <tbody id="rates-history-rows"></tbody>
      </table>
      <div style="margin-top:10px" id="latest-summary" class="muted"></div>
    </section>
  </main>

  <script type="module" src="/session-guard-lite.js?v=7"></script>
  <script type="module" src="/form-utils.js?v=7"></script>
  <script type="module">
    import { supabase } from './supabase-client.js';
    const set = (s)=> document.body.classList.toggle('authed', !!s);
    (async ()=>{ const { data: { session } } = await supabase.auth.getSession(); set(session); })();
    supabase.auth.onAuthStateChange((_e, session)=> set(session));
    document.getElementById('logout-btn')?.addEventListener('click', ()=> supabase.auth.signOut());
  </script>
  <script type="module" src="/admin-rates.js?v=ui-consistent"></script>
</body>
</html>
