<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>แผงควบคุมโปรโมชันสินเชื่อ</title>
    <link rel="manifest" href="/manifest.webmanifest">
    <meta name="theme-color" content="#34495e">
    <link rel="stylesheet" href="admin.css">
</head>
<body>

    <div id="gate" class="view container active">
        <h2>เข้าสู่ระบบผู้ดูแล</h2>
        <form id="login-form" autocomplete="on">
            <div class="form-group full-width"><label for="email">อีเมล</label><input type="email" id="email" name="email" required placeholder="name@example.com" autocomplete="username"></div>
            <div class="form-group full-width"><label for="password">รหัสผ่าน</label><input type="password" id="password" name="password" required placeholder="••••••••" autocomplete="current-password"></div>
            <div class="form-actions"><button type="submit" id="login-btn" class="btn-primary">เข้าสู่ระบบ</button></div>
        </form>
    </div>

    <div id="app" class="view container">
        <header>
            <h1>จัดการโปรโมชันสินเชื่อบ้าน</h1>
            <button id="logout-btn" class="btn-secondary">ออกจากระบบ</button>
        </header>

        <form id="promotion-form">
            <h2 class="full-width">เพิ่ม/แก้ไขโปรโมชัน</h2>
            <fieldset>
                <legend>ข้อมูลโปรโมชันหลัก</legend>
                <div class="sub-grid">
                    <div class="form-group"><label for="bank_id">ธนาคาร</label><select id="bank_id" name="bank_id" required></select></div>
                    <div class="form-group"><label for="promotion_name">ชื่อโปรโมชัน</label><input type="text" id="promotion_name" name="promotion_name" required></div>
                    <div class="form-group"><label for="start_date">วันที่เริ่ม</label><input type="date" id="start_date" name="start_date"></div>
                    <div class="form-group"><label for="end_date">วันที่สิ้นสุด</label><input type="date" id="end_date" name="end_date"></div>
                </div>
            </fieldset>

            <fieldset>
                <legend>โครงสร้างอัตราดอกเบี้ย</legend>
                <div id="interest-rates-container"></div>
                <button type="button" id="add-rate-year-btn" class="btn-secondary">เพิ่มปีดอกเบี้ย (+)</button>
                <div class="form-group form-group--checkbox full-width" style="margin-top: 15px;">
                    <input type="checkbox" id="has_mrta_option" name="has_mrta_option"><label for="has_mrta_option">มีตัวเลือก MRTA</label>
                </div>
            </fieldset>

            <fieldset>
                <legend>เงื่อนไขและเกณฑ์การพิจารณา</legend>
                <div class="sub-grid">
                    <div class="form-group"><label for="max_ltv">Max LTV (%)</label><input type="number" id="max_ltv" name="max_ltv"></div>
                    <div class="form-group"><label for="dsr_limit">DSR Limit (%)</label><input type="number" id="dsr_limit" name="dsr_limit"></div>
                    <div class="form-group"><label for="income_per_million">รายได้ต่อกู้ 1 ลบ./ด.</label><input type="number" id="income_per_million" name="income_per_million"></div>
                    <div class="form-group"><label for="min_living_expense">ค่าครองชีพขั้นต่ำ/ด.</label><input type="number" id="min_living_expense" name="min_living_expense"></div>
                    <div class="form-group"><label for="max_income">รายได้สูงสุดผู้กู้ (บาท/เดือน)</label><input type="number" id="max_income" name="max_income"></div>
                    <div class="form-group"><label for="max_loan_amount">วงเงินกู้สูงสุด (บาท)</label><input type="number" id="max_loan_amount" name="max_loan_amount"></div>
                    <div class="form-group"><label for="max_loan_tenure">อายุสัญญาสูงสุด (ปี)</label><input type="number" id="max_loan_tenure" name="max_loan_tenure"></div>
                    <div class="form-group"><label for="max_age_salaried">อายุผู้กู้สูงสุด (พนักงาน)</label><input type="number" id="max_age_salaried" name="max_age_salaried"></div>
                    <div class="form-group"><label for="max_age_business">อายุผู้กู้สูงสุด (ธุรกิจ)</label><input type="number" id="max_age_business" name="max_age_business"></div>
                </div>
            </fieldset>
            
            <div class="form-group form-group--checkbox full-width"><input type="checkbox" id="waive_mortgage_fee" name="waive_mortgage_fee"><label for="waive_mortgage_fee">ยกเว้นค่าจดจำนอง</label></div>
            <div class="form-group full-width"><label for="notes">หมายเหตุ</label><input type="text" id="notes" name="notes"></div>
            
            <div class="form-actions full-width">
                <button type="submit" id="save-btn" class="btn-primary">บันทึกโปรโมชัน</button>
                <button type="button" id="clear-btn" class="btn-secondary">ล้างฟอร์ม</button>
            </div>
        </form>

        <hr style="margin: 40px 0;">
        <div class="table-controls">
             <div class="form-group"><label for="search-input">ค้นหา</label><input type="search" id="search-input" placeholder="ค้นหาโปรโมชันหรือธนาคาร..."></div>
        </div>
        <div class="table-wrapper">
            <table id="promotions-table">
                <thead><tr><th>ธนาคาร</th><th>โปรโมชัน</th><th>เฉลี่ย 3 ปี (%)</th><th>จัดการ</th></tr></thead>
                <tbody></tbody>
            </table>
        </div>
    </div>
    
    <div id="toast"></div>

    <div id="confirm-modal" class="modal-backdrop">
        <div class="modal-content">
            <p id="modal-text">คุณแน่ใจหรือไม่?</p>
            <div class="modal-actions">
                <button id="modal-cancel-btn" class="btn-secondary">ยกเลิก</button>
                <button id="modal-confirm-btn" class="btn-danger">ยืนยันลบ</button>
            </div>
        </div>
    </div>

    <script type="module" src="supabase-client.js"></script>
    <script type="module" src="admin.js"></script>
    <script type="module" src="session-guard.js"></script>
</body>
</html>