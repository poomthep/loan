<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Console - ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô</title>
  <link rel="stylesheet" href="./app.css">
</head>
<body>
  <div class="container">
    <h1>üõ† Admin Console - ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£</h1>
    <form id="promoForm" class="form-box">
      <label>‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£:</label><input id="bank" type="text" required />
      <label>‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô:</label><input id="promo_name" type="text" required />
      <label>‡∏î‡∏≠‡∏Å‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏õ‡∏µ‡∏ó‡∏µ‡πà 1 (%):</label><input id="rate1" type="number" step="0.01" />
      <label>‡∏î‡∏≠‡∏Å‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏õ‡∏µ‡∏ó‡∏µ‡πà 2 (%):</label><input id="rate2" type="number" step="0.01" />
      <label>‡∏î‡∏≠‡∏Å‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏õ‡∏µ‡∏ó‡∏µ‡πà 3 (%):</label><input id="rate3" type="number" step="0.01" />
      <label>‡∏™‡∏π‡∏ï‡∏£‡∏î‡∏≠‡∏Å‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏õ‡∏µ‡∏ñ‡∏±‡∏î‡πÑ‡∏õ:</label><input id="final_formula" type="text" />
      <label>‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç:</label><input id="conditions" type="text" />
      <button type="submit" class="btn-primary">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô</button>
    </form>
    <h3>üìã ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>
    <table id="promoTable">
      <thead><tr><th>‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£</th><th>‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô</th><th>‡∏õ‡∏µ1</th><th>‡∏õ‡∏µ2</th><th>‡∏õ‡∏µ3</th><th>‡∏™‡∏π‡∏ï‡∏£‡∏ï‡πà‡∏≠‡πÑ‡∏õ</th><th>‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç</th></tr></thead>
      <tbody></tbody>
    </table>
  </div>
  <script type="module">
    import { supabase } from "./src/config/supabase-init.js";
    const form = document.getElementById("promoForm");
    const tableBody = document.querySelector("#promoTable tbody");
    async function loadPromotions(){
      const { data, error } = await supabase.from("promotions")
        .select("id, promo_name, rate_year1, rate_year2, rate_year3, final_rate_formula, conditions, banks(name)");
      if(error){ alert("‡πÇ‡∏´‡∏•‡∏î‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: "+error.message); return; }
      tableBody.innerHTML=""; data.forEach(p=>{
        const tr=document.createElement("tr");
        tr.innerHTML=`<td>${p.banks?.name||"-"}</td><td>${p.promo_name}</td>
        <td>${p.rate_year1||"-"}</td><td>${p.rate_year2||"-"}</td><td>${p.rate_year3||"-"}</td>
        <td>${p.final_rate_formula||"-"}</td><td>${p.conditions||"-"}</td>`;
        tableBody.appendChild(tr);
      });
    }
    form.addEventListener("submit", async e=>{
      e.preventDefault();
      const bank=document.getElementById("bank").value;
      const promoName=document.getElementById("promo_name").value;
      const rate1=parseFloat(document.getElementById("rate1").value)||null;
      const rate2=parseFloat(document.getElementById("rate2").value)||null;
      const rate3=parseFloat(document.getElementById("rate3").value)||null;
      const finalFormula=document.getElementById("final_formula").value;
      const conditions=document.getElementById("conditions").value;
      const { data: bankData, error: bankError } = await supabase.from("banks").select("id").eq("name", bank).single();
      if(bankError||!bankData){ alert("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ô‡∏µ‡πâ"); return; }
      const { error } = await supabase.from("promotions").insert([{
        bank_id: bankData.id, promo_name: promoName, rate_year1: rate1, rate_year2: rate2,
        rate_year3: rate3, final_rate_formula: finalFormula, conditions: conditions
      }]);
      if(error){ alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: "+error.message); } else { alert("‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à"); form.reset(); loadPromotions(); }
    });
    loadPromotions();
  </script>
</body>
</html>
