import supabase from './supabase-init.js'; const cache=new Map(); const key=(n,p)=>n+':'+JSON.stringify(p||{}); export async function checkDatabaseConnection(){try{const {error}=await supabase.from('banks').select('id',{count:'exact',head:true}); return !error;}catch(e){return false;}} export async function getBanks(){const k=key('banks'); if(cache.has(k)) return cache.get(k); const {data,error}=await supabase.from('banks').select('id,short_name,name').order('short_name'); const res=error?[]:data; cache.set(k,res); return res;} export async function getActivePromotions(productType='MORTGAGE'){const k=key('promotions',{productType}); if(cache.has(k)) return cache.get(k); const {data,error}=await supabase.from('promotions').select('id,bank_id,product_type,title,description,year1_rate,base_rate,spread,active').eq('active',true).eq('product_type',productType).order('id'); const res=error?[]:data; cache.set(k,res); return res;} export async function getUserCalculations(limit=10){ const {data,error}=await supabase.from('calculations').select('*').order('created_at',{ascending:false}).limit(limit); return error?[]:data;} export function clearAllCache(){cache.clear();} export default {checkDatabaseConnection,getBanks,getActivePromotions,getUserCalculations,clearAllCache};