import {supabase}from './supabase-init.js';import {REDIRECTS} from './supabase-config.js';export async function getSession(){return (await supabase.auth.getSession()).data.session}export async function login(email,password){const {data,error}=await supabase.auth.signInWithPassword({email,password});if(error)throw error;return data.session??null}export async function logout(){await supabase.auth.signOut();location.href=REDIRECTS.logout||'/'}export async function getProfileRole(){const s=await getSession();if(!s)return null;const uid=s.user.id;let {data,error}=await supabase.from('user_profiles').select('role').eq('id',uid).maybeSingle();if(error)throw error;if(!data){await supabase.from('user_profiles').insert({id:uid,role:'user'});return 'user'}return data.role||'user'}export async function requireLogin(role=null){const s=await getSession();if(!s){location.href='/';return}if(!role)return;const r=await getProfileRole();if(role==='admin'&&r!=='admin'){location.href='/loan/'}}export async function redirectAfterLogin(){const s=await getSession();if(!s)return;const r=await getProfileRole();location.href=r==='admin'?(REDIRECTS.admin||'/admin/'):(REDIRECTS.afterLogin||'/loan/') }